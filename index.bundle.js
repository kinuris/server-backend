(()=>{"use strict";var e,t,r,n,o={245:(e,t,r)=>{r.d(t,{o:()=>i});var n=r(344),o=r.n(n);function i(e,t={}){const r=void 0===t?{}:t;return function(t,n,i){if(t.params.name===e)if(t.body.should_browser_route=!0,t.params.directory_or_file&&!t.params.file&&`/${t.params.directory_or_file}`in r){const{redirect:e,onFail:a}=r[`/${t.params.directory_or_file}`];if(`/${t.params.directory_or_file}`in r){if(a){if(!t.body.auth_token)return void n.redirect(e);try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(t){return n.clearCookie("auth_token"),void n.redirect(e)}return void i()}if(!t.body.auth_token)return void i();try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return n.clearCookie("auth_token"),void i()}return void n.redirect(e)}}else if(t.params.directory_or_file&&t.params.file&&`/${t.params.directory_or_file}/${t.params.file}`in r){const{redirect:e,onFail:a}=r[`/${t.params.directory_or_file}/${t.params.file}`];if(`/${t.params.directory_or_file}/${t.params.file}`in r){if(a){if(!t.body.auth_token)return void n.redirect(e);try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(t){return n.clearCookie("auth_token"),void n.redirect(e)}return void i()}if(!t.body.auth_token)return void i();try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return n.clearCookie("auth_token"),void i()}return void n.redirect(e)}}i()}}},22:(e,t,r)=>{r.d(t,{T:()=>i});var n=r(17),o=r.n(n);const i=[function(e,t,r){e.params.directory_or_file||e.params.file?r():t.sendFile(o().join(__dirname,"sites",e.params.name,"index.html"))},function(e,t,r){if(e.params.directory_or_file&&!e.params.file)return e.params.directory_or_file.split(".").length>=2?void t.sendFile(o().join(__dirname,"sites",e.params.name,e.params.directory_or_file)):e.body.should_browser_route?void t.sendFile(o().join(__dirname,"sites",e.params.name,"index.html")):void t.status(403).sendFile(o().join(__dirname,"sites","default","forbidden.html"));r()},function(e,t,r){if(!(e.params.file.split(".").length>=2))return e.body.should_browser_route?void t.sendFile(o().join(__dirname,"sites",e.params.name,"index.html")):void t.status(403).sendFile(o().join(__dirname,"sites","default","forbidden.html"));r()}]},946:(e,t,r)=>{r.d(t,{G:()=>i});var n=r(344),o=r.n(n);function i(e,t,r={}){const n=t+(void 0===r.alertMessage?"":`?alertmsg=${encodeURIComponent(r.alertMessage)}`);return function(t,r,i){if(t.params.name!==e)i();else{if(t.body.auth_token){try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return r.clearCookie("auth_token"),void r.redirect(n)}return void i()}r.redirect(n)}}}},68:(e,t,r)=>{r.d(t,{y:()=>i});var n=r(344),o=r.n(n);function i(e,t,r={}){const n=t+(void 0===r.alertMessage?"":`?alertmsg=${encodeURIComponent(r.alertMessage)}`);return function(t,r,i){if(t.params.name!==e)i();else{if(t.body.auth_token){try{const e=o().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return r.clearCookie("auth_token"),void i()}return void r.redirect(n)}i()}}}},378:(e,t,r)=>{function n(e,t,r){if(e.header("Cookie")){const[t,r]=e.header("Cookie").split("=");"auth_token"===t&&(e.body.auth_token=r)}r()}r.d(t,{D:()=>n})},812:(e,t,r)=>{r.d(t,{P:()=>i});var n=r(344),o=r.n(n);function i(e,t=""){return function(r,n,i){if(r.body.auth_token){try{const e=o().verify(r.body.auth_token,process.env.SECRET);r.body.user_id=e.id}catch(r){return n.clearCookie("auth_token"),void n.status(e).send(t).end()}i()}else n.status(e).send(t).end()}}},368:(e,t,r)=>{function n(e,t,r){""!==e.body.password&&""!==e.body.email?r():t.status(400).end()}r.d(t,{_:()=>n})},469:(e,t,r)=>{function n(e,t,r){""!==e.body.username&&""!==e.body.password&&""!==e.body.email?r():t.status(400).end()}r.d(t,{Q:()=>n})},920:(e,t,r)=>{r.d(t,{j:()=>s});var n=r(250),o=r(345),i=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class extends n.BaseEntity{};i([(0,o.Field)((()=>o.ID)),(0,n.PrimaryGeneratedColumn)("uuid",{name:"id"}),a("design:type",String)],s.prototype,"userID",void 0),i([(0,o.Field)(),(0,n.Column)("text"),a("design:type",String)],s.prototype,"name",void 0),i([(0,o.Field)(),(0,n.Column)("int"),a("design:type",Number)],s.prototype,"price",void 0),i([(0,o.Field)(),(0,n.Column)({name:"img_link"}),a("design:type",String)],s.prototype,"imageLink",void 0),s=i([(0,o.ObjectType)(),(0,n.Entity)({name:"menu"})],s)},34:(e,t,r)=>{r.d(t,{n:()=>s});var n=r(250),o=r(345),i=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class extends n.BaseEntity{};i([(0,o.Field)((()=>o.ID)),(0,n.PrimaryGeneratedColumn)("uuid",{name:"user_id"}),a("design:type",String)],s.prototype,"userID",void 0),i([(0,o.Field)(),(0,n.Column)("text"),a("design:type",String)],s.prototype,"email",void 0),i([(0,o.Field)(),(0,n.Column)("text"),a("design:type",String)],s.prototype,"password",void 0),i([(0,o.Field)(),(0,n.Column)("varchar",{length:20}),a("design:type",String)],s.prototype,"username",void 0),i([(0,o.Field)(),(0,n.Column)("boolean"),a("design:type",Boolean)],s.prototype,"admin",void 0),i([(0,o.Field)(),(0,n.Column)({name:"profile_img_link"}),a("design:type",String)],s.prototype,"profileImageLink",void 0),s=i([(0,o.ObjectType)(),(0,n.Entity)({name:"users"})],s)},607:(e,t,r)=>{r.a(e,(async(e,t)=>{try{r(236);var n=r(860),o=r.n(n),i=r(415),a=r.n(i),s=r(17),d=r.n(s),l=r(142),c=r.n(l),u=r(96),p=r.n(u),f=r(344),y=r.n(f),m=r(582),_=r.n(m),v=r(55),g=r(345),b=r(22),h=r(469),w=r(378),k=r(946),j=r(368),R=r(68),S=r(245),x=r(812),C=r(250),E=r(34),O=r(920),F=r(239),P=r(800);c().config({path:__dirname+"/.env"});const e=o()(),D=a()(e).app;D.use(o().static("static")),D.use(o().json()),D.use(_()()),await new C.DataSource({type:"postgres",host:process.env.DB_HOST,port:5432,username:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,synchronize:!0,entities:[E.n,O.j],subscribers:[],migrations:[]}).initialize();const q=await(0,g.buildSchema)({resolvers:[F.N,P.O]});D.use(w.D),D.post("/signup",h.Q,(async(e,t)=>{const r=new E.n;r.password=await p().hash(e.body.password,await p().genSalt(10)),r.username=e.body.username,r.email=e.body.email,r.admin=!1,r.profileImageLink=e.body.profile_img_link?e.body.profile_img_link:"";const n=await E.n.findOne({where:{email:r.email}}),o=await E.n.findOne({where:{username:r.username}});if(n)t.status(401).send("User With That Email Already Exists").end();else if(o)t.status(401).send("User With That Username Already Exists").end();else{try{await r.save()}catch(e){return void t.status(500).end()}t.status(200).end()}})),D.post("/login",j._,(async(e,t)=>{const r=await E.n.findOne({where:{email:e.body.email}});if(r)if(await p().compare(e.body.password,r.password)){const e=y().sign({id:r.userID},process.env.SECRET,{expiresIn:3600});t.setHeader("Set-Cookie",`auth_token=${e}`),t.status(200).send("Login successful").end()}else t.status(401).send("Wrong email or password").end();else t.status(401).send("Wrong email or password").end()})),D.post("/create-item",(async(e,t)=>{try{const t=new O.j;t.name=e.body.name,t.price=e.body.price,t.imageLink="",await t.save()}catch(e){t.status(400).send(e.toString()).end()}t.status(200).end()})),D.post("/clear-all",((e,t)=>{t.clearCookie("auth_token"),t.end()})),D.get("/fetch",(0,x.P)(403),(async(e,t)=>{const r=await O.j.find();t.json({data:r})})),D.ws("/websocket/",((e,t)=>{e.on("message",(r=>{e.send(`Hello There, From Server. Your Message Was: ${r.toString()}, And Your IP Is: ${t.headers["x-real-ip"]}`)}))})),D.get("/",((e,t)=>t.sendFile(d().join(__dirname,"sites","index","index.html")))),D.get("/:name/:directory_or_file?/:file?",(0,k.G)("register-item","/login",{alertMessage:"You are logged out"}),(0,R.y)("login","/register-item",{alertMessage:"You are already logged in"}),(0,R.y)("signup","/register-item",{alertMessage:"Must logout first"}),(0,S.o)("cookie-bite",{"/login":{redirect:"/cookie-bite/",onFail:!1},"/signup":{redirect:"/cookie-bite/",onFail:!1}}),...b.T,((e,t)=>{t.sendFile(d().join(__dirname,"sites",e.url))}));const T=new v.ApolloServer({schema:q,context:({req:e})=>({req:e})});await T.start(),T.applyMiddleware({app:D,path:"/api"}),D.listen({port:5500},(()=>{console.log("Server is listening of port 5500")})),t()}catch(e){t(e)}}),1)},239:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(345),o=r(920),i=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class{async fetchAll(){return await o.j.find()}};i([(0,n.Query)((e=>[o.j])),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],s.prototype,"fetchAll",null),s=i([(0,n.Resolver)(o.j)],s)},800:(e,t,r)=>{r.d(t,{O:()=>c});var n=r(344),o=r.n(n),i=r(345),a=r(34),s=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t){return function(r,n){t(r,n,e)}};let c=class{async isAvailableUsername(e){return!await a.n.findOne({where:{username:e}})}async isAvailableEmail(e){return!await a.n.findOne({where:{email:e}})}async getUserData(e){const{req:t}=e;if(!t.body.auth_token)return null;try{o().verify(t.body.auth_token,process.env.SECRET)}catch(e){return null}const r=o().decode(t.body.auth_token);return await a.n.findOne({where:{userID:r.id}})}};s([(0,i.Query)((e=>Boolean)),l(0,(0,i.Arg)("username")),d("design:type",Function),d("design:paramtypes",[String]),d("design:returntype",Promise)],c.prototype,"isAvailableUsername",null),s([(0,i.Query)((e=>Boolean)),l(0,(0,i.Arg)("email")),d("design:type",Function),d("design:paramtypes",[String]),d("design:returntype",Promise)],c.prototype,"isAvailableEmail",null),s([(0,i.Query)((e=>a.n),{nullable:!0}),l(0,(0,i.Ctx)()),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],c.prototype,"getUserData",null),c=s([(0,i.Resolver)(a.n)],c)},55:e=>{e.exports=require("apollo-server-express")},96:e=>{e.exports=require("bcrypt")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},415:e=>{e.exports=require("express-ws")},344:e=>{e.exports=require("jsonwebtoken")},236:e=>{e.exports=require("reflect-metadata")},345:e=>{e.exports=require("type-graphql")},250:e=>{e.exports=require("typeorm")},17:e=>{e.exports=require("path")}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,a),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(o,i,a)=>{var s;a&&((s=[]).d=1);var d,l,c,u=new Set,p=o.exports,f=new Promise(((e,t)=>{c=t,l=e}));f[t]=p,f[e]=e=>(s&&e(s),u.forEach(e),f.catch((e=>{}))),o.exports=f,i((o=>{var i;d=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var i=[];i.d=0,o.then((e=>{a[t]=e,n(i)}),(e=>{a[r]=e,n(i)}));var a={};return a[e]=e=>e(i),a}}var s={};return s[e]=e=>{},s[t]=o,s})))(o);var a=()=>d.map((e=>{if(e[r])throw e[r];return e[t]})),l=new Promise((t=>{(i=()=>t(a)).r=0;var r=e=>e!==s&&!u.has(e)&&(u.add(e),e&&!e.d&&(i.r++,e.push(i)));d.map((t=>t[e](r)))}));return i.r?l:a()}),(e=>(e?c(f[r]=e):l(p),n(s)))),s&&(s.d=0)},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(607)})();
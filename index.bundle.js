(()=>{"use strict";var e,t,r,o,n={245:(e,t,r)=>{r.d(t,{o:()=>i});var o=r(344),n=r.n(o);function i(e,t={}){const r=void 0===t?{}:t;return function(t,o,i){if(t.params.name===e)if(t.body.should_browser_route=!0,t.params.directory_or_file&&!t.params.file&&`/${t.params.directory_or_file}`in r){const{redirect:e,onFail:a}=r[`/${t.params.directory_or_file}`];if(`/${t.params.directory_or_file}`in r){if(a){if(!t.body.auth_token)return void o.redirect(e);try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(t){return o.clearCookie("auth_token"),void o.redirect(e)}return void i()}if(!t.body.auth_token)return void i();try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return o.clearCookie("auth_token"),void i()}return void o.redirect(e)}}else if(t.params.directory_or_file&&t.params.file&&`/${t.params.directory_or_file}/${t.params.file}`in r){const{redirect:e,onFail:a}=r[`/${t.params.directory_or_file}/${t.params.file}`];if(`/${t.params.directory_or_file}/${t.params.file}`in r){if(a){if(!t.body.auth_token)return void o.redirect(e);try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(t){return o.clearCookie("auth_token"),void o.redirect(e)}return void i()}if(!t.body.auth_token)return void i();try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return o.clearCookie("auth_token"),void i()}return void o.redirect(e)}}i()}}},22:(e,t,r)=>{r.d(t,{T:()=>i});var o=r(17),n=r.n(o);const i=[function(e,t,r){e.params.directory_or_file||e.params.file?r():t.sendFile(n().join(__dirname,"sites",e.params.name,"index.html"))},function(e,t,r){if(e.params.directory_or_file&&!e.params.file)return e.params.directory_or_file.split(".").length>=2?void t.sendFile(n().join(__dirname,"sites",e.params.name,e.params.directory_or_file)):e.body.should_browser_route?void t.sendFile(n().join(__dirname,"sites",e.params.name,"index.html")):void t.status(403).sendFile(n().join(__dirname,"sites","default","forbidden.html"));r()},function(e,t,r){if(!(e.params.file.split(".").length>=2))return e.body.should_browser_route?void t.sendFile(n().join(__dirname,"sites",e.params.name,"index.html")):void t.status(403).sendFile(n().join(__dirname,"sites","default","forbidden.html"));r()}]},946:(e,t,r)=>{r.d(t,{G:()=>i});var o=r(344),n=r.n(o);function i(e,t,r={}){const o=t+(void 0===r.alertMessage?"":`?alertmsg=${encodeURIComponent(r.alertMessage)}`);return function(t,r,i){if(t.params.name!==e)i();else{if(t.body.auth_token){try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return r.clearCookie("auth_token"),void r.redirect(o)}return void i()}r.redirect(o)}}}},68:(e,t,r)=>{r.d(t,{y:()=>i});var o=r(344),n=r.n(o);function i(e,t,r={}){const o=t+(void 0===r.alertMessage?"":`?alertmsg=${encodeURIComponent(r.alertMessage)}`);return function(t,r,i){if(t.params.name!==e)i();else{if(t.body.auth_token){try{const e=n().verify(t.body.auth_token,process.env.SECRET);t.body.user_id=e.id}catch(e){return r.clearCookie("auth_token"),void i()}return void r.redirect(o)}i()}}}},378:(e,t,r)=>{function o(e,t,r){if(e.header("Cookie")){const[t,r]=e.header("Cookie").split("=");"auth_token"===t&&(e.body.auth_token=r)}r()}r.d(t,{D:()=>o})},812:(e,t,r)=>{r.d(t,{P:()=>i});var o=r(344),n=r.n(o);function i(e,t=""){return function(r,o,i){if(r.body.auth_token){try{const e=n().verify(r.body.auth_token,process.env.SECRET);r.body.user_id=e.id}catch(r){return o.clearCookie("auth_token"),void o.status(e).send(t).end()}i()}else o.status(e).send(t).end()}}},368:(e,t,r)=>{function o(e,t,r){""!==e.body.password&&""!==e.body.email?r():t.status(400).end()}r.d(t,{_:()=>o})},469:(e,t,r)=>{function o(e,t,r){""!==e.body.username&&""!==e.body.password&&""!==e.body.email?r():t.status(400).end()}r.d(t,{Q:()=>o})},920:(e,t,r)=>{r.d(t,{j:()=>s});var o=r(250),n=r(345),i=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class extends o.BaseEntity{};i([(0,n.Field)((()=>n.ID)),(0,o.PrimaryGeneratedColumn)("uuid",{name:"id"}),a("design:type",String)],s.prototype,"userID",void 0),i([(0,n.Field)(),(0,o.Column)("text"),a("design:type",String)],s.prototype,"name",void 0),i([(0,n.Field)(),(0,o.Column)("int"),a("design:type",Number)],s.prototype,"price",void 0),i([(0,n.Field)(),(0,o.Column)({name:"img_link"}),a("design:type",String)],s.prototype,"imageLink",void 0),s=i([(0,n.ObjectType)(),(0,o.Entity)({name:"menu"})],s)},34:(e,t,r)=>{r.d(t,{n:()=>s});var o=r(250),n=r(345),i=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class extends o.BaseEntity{};i([(0,n.Field)((()=>n.ID)),(0,o.PrimaryGeneratedColumn)("uuid",{name:"user_id"}),a("design:type",String)],s.prototype,"userID",void 0),i([(0,n.Field)(),(0,o.Column)("text"),a("design:type",String)],s.prototype,"email",void 0),i([(0,n.Field)(),(0,o.Column)("text"),a("design:type",String)],s.prototype,"password",void 0),i([(0,n.Field)(),(0,o.Column)("varchar",{length:20}),a("design:type",String)],s.prototype,"username",void 0),i([(0,n.Field)(),(0,o.Column)("boolean"),a("design:type",Boolean)],s.prototype,"admin",void 0),i([(0,n.Field)(),(0,o.Column)({name:"profile_img_link"}),a("design:type",String)],s.prototype,"profileImageLink",void 0),s=i([(0,n.ObjectType)(),(0,o.Entity)({name:"users"})],s)},607:(e,t,r)=>{r.a(e,(async(e,t)=>{try{r(236);var o=r(860),n=r.n(o),i=r(415),a=r.n(i),s=r(17),d=r.n(s),c=r(142),l=r.n(c),u=r(96),p=r.n(u),f=r(344),y=r.n(f),m=r(55),_=r(345),v=r(22),h=r(469),b=r(378),g=r(946),w=r(368),k=r(68),x=r(245),S=r(812),j=r(250),C=r(34),E=r(920),R=r(239);l().config({path:__dirname+"/.env"});const e=n()(),F=a()(e).app;F.use(n().static("static")),F.use(n().json()),await new j.DataSource({type:"postgres",host:process.env.DB_HOST,port:5432,username:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,synchronize:!0,entities:[C.n,E.j],subscribers:[],migrations:[]}).initialize();const O=await(0,_.buildSchema)({resolvers:[R.N]});process.env.MENU_TABLE_NAME,F.use(b.D),F.post("/signup",h.Q,(async(e,t)=>{const r=new C.n;r.password=await p().hash(e.body.password,await p().genSalt(10)),r.username=e.body.username,r.email=e.body.email,r.admin=!1,r.profileImageLink="";const o=await C.n.findOne({where:{email:r.email}}),n=await C.n.findOne({where:{username:r.username}});if(o)t.status(401).send("User With That Email Already Exists").end();else if(n)t.status(401).send("User With That Username Already Exists").end();else{try{await r.save()}catch(e){return void t.status(500).end()}t.status(200).end()}})),F.post("/login",w._,(async(e,t)=>{const r=await C.n.findOne({where:{email:e.body.email}});if(r)if(await p().compare(e.body.password,r.password)){const e=y().sign({id:r.userID},process.env.SECRET,{expiresIn:3600});t.setHeader("Set-Cookie",`auth_token=${e}`),t.status(200).send("Login successful").end()}else t.status(401).send("Wrong email or password").end();else t.status(401).send("Wrong email or password").end()})),F.post("/create-item",(async(e,t)=>{try{const t=new E.j;t.name=e.body.name,t.price=e.body.price,t.imageLink="",await t.save()}catch(e){t.status(400).send(e.toString()).end()}t.status(200).end()})),F.post("/clear-all",((e,t)=>{t.clearCookie("auth_token"),t.end()})),F.get("/fetch",(0,S.P)(403),(async(e,t)=>{const r=await E.j.find();t.json({data:r})})),F.ws("/websocket/",((e,t)=>{e.on("message",(r=>{e.send(`Hello There, From Server. Your Message Was: ${r.toString()}, And Your IP Is: ${t.headers["x-real-ip"]}`)}))})),F.get("/",((e,t)=>t.sendFile(d().join(__dirname,"sites","index","index.html")))),F.get("/:name/:directory_or_file?/:file?",(0,g.G)("register-item","/login",{alertMessage:"You are logged out"}),(0,k.y)("login","/register-item",{alertMessage:"You are already logged in"}),(0,k.y)("signup","/register-item",{alertMessage:"Must logout first"}),(0,x.o)("cookie-bite"),...v.T,((e,t)=>{t.sendFile(d().join(__dirname,"sites",e.url))}));const P=new m.ApolloServer({schema:O,context:({req:e})=>({req:e})});await P.start(),P.applyMiddleware({app:F,path:"/api"}),F.listen({port:5500},(()=>{console.log("Server is listening of port 5500")})),t()}catch(e){t(e)}}),1)},239:(e,t,r)=>{r.d(t,{N:()=>s});var o=r(345),n=r(920),i=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class{async fetchAll(){return await n.j.find()}};i([(0,o.Query)((e=>[n.j])),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],s.prototype,"fetchAll",null),s=i([(0,o.Resolver)(n.j)],s)},55:e=>{e.exports=require("apollo-server-express")},96:e=>{e.exports=require("bcrypt")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},415:e=>{e.exports=require("express-ws")},344:e=>{e.exports=require("jsonwebtoken")},236:e=>{e.exports=require("reflect-metadata")},345:e=>{e.exports=require("type-graphql")},250:e=>{e.exports=require("typeorm")},17:e=>{e.exports=require("path")}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,a),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(n,i,a)=>{var s;a&&((s=[]).d=1);var d,c,l,u=new Set,p=n.exports,f=new Promise(((e,t)=>{l=t,c=e}));f[t]=p,f[e]=e=>(s&&e(s),u.forEach(e),f.catch((e=>{}))),n.exports=f,i((n=>{var i;d=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var i=[];i.d=0,n.then((e=>{a[t]=e,o(i)}),(e=>{a[r]=e,o(i)}));var a={};return a[e]=e=>e(i),a}}var s={};return s[e]=e=>{},s[t]=n,s})))(n);var a=()=>d.map((e=>{if(e[r])throw e[r];return e[t]})),c=new Promise((t=>{(i=()=>t(a)).r=0;var r=e=>e!==s&&!u.has(e)&&(u.add(e),e&&!e.d&&(i.r++,e.push(i)));d.map((t=>t[e](r)))}));return i.r?c:a()}),(e=>(e?l(f[r]=e):c(p),o(s)))),s&&(s.d=0)},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a(607)})();